<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOOK WEBSITE</title>
    <link href="bootstrap-5.3.5-dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Link Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            background-color: #F0F0F0;
        }

        nav {
            position: sticky;
            top: 0;
            z-index: 1020;
            background: rgba(0, 0, 0, 0.92);
        }

        .hr_DanhMuc {
            width: 90%;
            margin: 5px;
        }

        .dropdown-item {
            margin-left: 2px;
        }

        .dropdown-item:hover {
            background: linear-gradient(135deg, #af4949, #55b8a9, #8256ce);
            color: #fff;
            font-weight: bolder;
            font-size: medium;
        }

        .a_click {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }

        .a_click:hover {
            color: black;
        }

        .dropdown-menu {
            background: #212529c7;
            color: #fff;
        }

        .dropdown-item {
            color: white;
        }

        .nav-item.dropdown:hover .dropdown-menu {
            display: block;
            margin-top: 0;
        }

        iframe {
            margin-bottom: 0 !important;
            padding-bottom: 0 !important;
            display: block;
            /* Đảm bảo iframe không có khoảng cách inline */
        }

        footer {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }

        
    </style>
</head>

<body>
    <div class="container-fluid p-0">
        <nav class="navbar navbar-expand-lg  navbar-dark sticky-top  "> <!--Hoặc sài sticky -->
            <div class="container-fluid">
                <a href="index.html" class="navbar-brand ms-5">
                    <img src="https://bookwebsitedata.blob.core.windows.net/media/data/Hinh/image-Photoroom.png" width="300" alt="">
                </a>
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-content">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbar-content">
                    <ul class="navbar-nav ms-2 gap-2 me-5">
                        <li class="nav-item"><a class="nav-link active" href="index.html">Trang chủ</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown"><i
                                    class="fa-solid fa-list-ul"></i> Danh Mục</a>
                            <ul class="dropdown-menu p-3 " style="min-width: 700px;">
                                <div class="row">
                                    <div class="col-4">
                                        <li><a class="dropdown-item " href="#">Mới Cập Nhật</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                        <li><a class="dropdown-item" href="#">Sách VIP Free</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                        <li><a class="dropdown-item" href="#">Phát Ngôn Chính Sách</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                    </div>
                                    <div class="col-4">
                                        <li><a class="dropdown-item " href="#">Sách Mới</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                        <li><a class="dropdown-item" href="#">Bảng Xếp Hạng</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                        <li><a class="dropdown-item" href="#">Quy Chế Vip</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                    </div>
                                    <div class="col-4">
                                        <li><a class="dropdown-item " href="#">Sách Full</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                        <li><a class="dropdown-item" href="#">Sách Ngẫu Nhiên</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                        <li><a class="dropdown-item" href="#">Nhúng Sách</a>
                                            <hr class="mx-auto hr_DanhMuc">
                                        </li>
                                    </div>

                                </div>
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle " href="#" data-bs-toggle="dropdown"
                                onclick="laydanhsachtheloai()"><i class="fa-solid fa-layer-group"></i> Thể Loại</a>
                            <ul class="dropdown-menu" id="listtheloai"></ul>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="About-index.html">About</a></li>
                    </ul>


                    <div class="d-flex align-items-center gap-2 ms-auto">
                        <input type="search" placeholder="Search" class="form-control" style="width: 500px;"
                            id="nhaptimkiem">
                        <button type="button" class="btn btn-outline-light me-5" id="timkiem"
                            onclick="timkiem()">Search</button>

                        <button type="button" id="btnFavorites"
                            class="btn btn-outline-light position-relative ms-5 me-2" data-bs-target="#loginModal">
                            <i class="fa-solid fa-bookmark"></i>
                            <span
                                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                0
                            </span>
                        </button>

                        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#registerModal">
                            <i class="fa fa-user-plus"></i> Đăng ký
                        </button>

                        <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i class="fa fa-user"></i> Đăng nhập
                        </button>
                    </div>
                </div>
        </nav>

        <div class="modal fade" id="registerModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-white ">
                    <div class="modal-header border-0 justify-content-center position-relative">
                        <h5 class="modal-title fs-2 fw-bold text-uppercase w-100 text-center">Đăng ký tài khoản</h5>
                        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3"
                            data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-center mb-1">
                        <p>Đăng ký để mua và theo dõi quá trình đọc sách</p>
                        <form>
                            <div class="mb-3">
                                <input type="text" class="form-control" placeholder="Tên tài khoản" id="nhaptaikhoan">
                            </div>
                            <div class="mb-3 position-relative">
                                <input type="password" class="form-control" placeholder="Mật khẩu (ít nhất 6 ký tự)"
                                    id="nhapmatkhau">
                            </div>
                            <div class="mb-3 position-relative">
                                <input type="password" class="form-control" placeholder="Nhập lại mật khẩu"
                                    id="nhaplaimatkhau">
                            </div>
                            <button type="submit" class="btn btn-success w-100" onclick="dangki()">Đăng ký</button>
                        </form>

                        <hr class="text-secondary">

                        <div class="text-center mt-3 small">
                            Bằng việc nhấn “Đăng ký”, bạn đã đồng ý với điều khoản của chúng tôi.
                        </div>
                        <div class="text-center mt-2">
                            Bạn đã có tài khoản? <a href="#" class="text-info" id="goToLogin">Đăng nhập ngay</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="loginModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-white ">
                    <div class="modal-header border-0 justify-content-center position-relative">
                        <h5 class="modal-title fs-2 fw-bold text-uppercase w-100 text-center">Đăng Nhập tài khoản</h5>
                        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3"
                            data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-center mb-1">
                        <form>
                            <div class="mb-3">
                                <input type="text" class="form-control" placeholder="Tên tài khoản" id="nhaptaikhoan1">
                            </div>
                            <div class="mb-3 position-relative">
                                <input type="password" class="form-control" placeholder="Mật khẩu" id="nhapmatkhau1">
                            </div>

                            <button type="submit" class="btn btn-success w-100" onclick="dangnhap()">Đăng nhập</button>
                        </form>

                        <hr class="text-secondary">

                        <div class="text-center mt-3 small">
                            Bằng việc nhấn “Đăng nhập”, bạn đã đồng ý với điều khoản của chúng tôi.
                        </div>
                        <div class="text-center mt-2">
                            Bạn đã có tài khoản chưa? <a href="#" class="text-info" id="goToRegister">Đăng ký ngay</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Phần BODY -->
        <iframe name="Chitietsach" id="Chitietsach" src="BodyBook.html" width="100%" frameborder="0"
            scrolling="no"></iframe>


        <!-- Phần FOOTER-->
        <footer class="bg-dark text-white pt-5 pb-4 ">
            <div class="container text-center text-md-start">
                <div class="row justify-content-center">
                    <div class="col-6">
                        <h5 class="text-warning fw-bold">BOOK <span class="text-white">WEBSITE</span></h5>
                        <p class="small fs-6 fw-semibold text-secondary">
                            Đây là sản phẩm đầu tay của nhóm chúng em, nhằm tạo ra một thư viện sách nói và truyện audio
                            miễn phí cho mọi người. Ứng dụng công nghệ AI hiện đại giúp tăng trải nghiệm học tập và giải
                            trí dễ tiếp cận hơn.
                        </p>
                        <p class="small fw-semibold fs-6 text-secondary mb-0">
                            Mọi thắc mắc về Website:
                            <a href="mailto:dainguyenjkl@gmail.com"
                                class="text-secondary fw-bold">dainguyenjkl@gmail.com</a>
                        </p>
                    </div>
                    <div class="col-6">
                        <h6 class="text-uppercase fw-bold text-warning mb-3 ms-5">Thông tin Liên hệ</h6>
                        <ul class="list-unstyled fs-6 small ms-5">
                            <li class="mb-2"><a href="#" class="text-decoration-none text-secondary "><i
                                        class="fa-solid fa-location-dot me-1"></i> <b>Địa Chỉ: </b>140 - Lê Trọng Tấn</a></li>
                            <li class="mb-2"><a href="#" class="text-decoration-none text-secondary "><i
                                        class="fa-solid fa-phone-volume me-1"></i> <b>Điện thoại: </b>0359699177</a>
                            </li>
                            <li><a href="#" class="text-decoration-none text-secondary "><i class="fa-solid fa-envelope me-1"></i> <b>Email: </b>dainguyenjkl@gmail.com</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <hr class="border-secondary my-4">
                <div class="text-center text-secondary small">
                    &copy; 2025 BOOKWEBSITE — Kho sách miễn phí cho cộng đồng.
                </div>
            </div>
        </footer>
    </div>


    <script>
        // Xử lí đăng nhập đăng kí
        document.getElementById("btnFavorites").addEventListener("click", function () {
            // Giả sử người dùng chưa đăng nhập (có thể thay đổi điều kiện sau này)
            const isLoggedIn = false;

            if (!isLoggedIn) {
                const loginModal = new bootstrap.Modal(document.getElementById("loginModal"));
                loginModal.show();
            } else {
                // Sau này nếu đã đăng nhập, có thể chuyển đến trang yêu thích
                // window.location.href = "yeuthich.html";
            }
        });
        document.addEventListener("DOMContentLoaded", function () {
            const loginModalEl = document.getElementById('loginModal');
            const registerModalEl = document.getElementById('registerModal');

            // Khi nhấn chuyển sang đăng ký
            document.getElementById("goToRegister").addEventListener("click", function (e) {
                e.preventDefault();
                const loginModal = bootstrap.Modal.getInstance(loginModalEl);
                loginModalEl.addEventListener('hidden.bs.modal', function handler() {
                    const registerModal = new bootstrap.Modal(registerModalEl);
                    registerModal.show();
                    loginModalEl.removeEventListener('hidden.bs.modal', handler);
                });
                loginModal.hide();
            });

            // Khi nhấn chuyển sang đăng nhập
            document.getElementById("goToLogin").addEventListener("click", function (e) {
                e.preventDefault();
                const registerModal = bootstrap.Modal.getInstance(registerModalEl);
                registerModalEl.addEventListener('hidden.bs.modal', function handler() {
                    const loginModal = new bootstrap.Modal(loginModalEl);
                    loginModal.show();
                    registerModalEl.removeEventListener('hidden.bs.modal', handler);
                });
                registerModal.hide();
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            document.querySelector("#loginModal form").addEventListener("submit", function (e) {
                e.preventDefault(); // Ngăn form reload
                // Thực hiện xử lý đăng nhập tại đây (nếu có)
                console.log("Đã nhấn đăng nhập");
            });

            document.querySelector("#registerModal form").addEventListener("submit", function (e) {
                e.preventDefault(); // Ngăn form reload
                // Xử lý đăng ký nếu có
                console.log("Đã nhấn đăng ký");
            });
        });

        // Hàm lấy danh sách thể loại từ database qua api '/api/theloai'
        async function laydanhsachtheloai() {
            try {
                const response = await fetch('http://localhost:3000/api/theloai', {
                    method: 'GET'
                });
                const theloais = await response.json();
                const listtheloai = document.getElementById('listtheloai');
                listtheloai.innerHTML = '';
                theloais.forEach(theloai => {
                    const li = document.createElement('li');
                    li.innerHTML = '<a class="dropdown-item" href="#">' + theloai.TENTHELOAI + '</a>';
                    listtheloai.appendChild(li);
                });
            } catch (err) {
                console.error('Lỗi:', err);
            }
        }


        // Hàm tìm kiếm
        async function timkiem() {
            const data1 = document.getElementById("nhaptimkiem").value.trim();
            if (!data1) {
                alert("Vui long nhap thong tin tim kiem");
                return;
            }

            try {
                const response = await fetch(`http://localhost:3000/api/timkiem?query=${encodeURIComponent(data1)}`, {
                    method: 'GET'
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                    return;
                }
                const ketqua = await response.json();

                if (ketqua.ketquatimkiem.length > 0) {
                    const ketquatimkiemData = ketqua.ketquatimkiem || [];
                    localStorage.setItem('ketquatimkiem', JSON.stringify(ketquatimkiemData));
                    localStorage.setItem('isSearch', 'true');
                    const iframe = document.getElementById("Chitietsach");
                    iframe.src = ketqua.redirect;
                } else {
                    alert("khong tim thay ket qua nao");
                    return;
                }
            } catch (err) {
                console.error('Lỗi:', err);
            }
        }
        document.getElementById("nhaptimkiem").addEventListener("keypress", function (e) {
            if (e.key == 'Enter') {
                timkiem();
            }
        })

        // Hàm đăng kí
        async function dangki() {
            const taikhoan = document.getElementById("nhaptaikhoan").value.trim();
            const matkhau = document.getElementById("nhapmatkhau").value.trim();
            const matkhau1 = document.getElementById("nhaplaimatkhau").value.trim();
            if (!taikhoan || !matkhau || !matkhau1) {
                alert('Vui lòng nhập thong tin dang ki');
                return;
            }
            else if (matkhau.length < 6 || matkhau1.length < 6) {
                alert("Mật khẩu không đủ độ dài");
                return;
            }
            if (!(matkhau === matkhau1)) {
                alert("Mật khâu xác nhận không giống nhau");
                return;
            }
            const trangthaidangnhap = 1;
            try {
                const response = await fetch('http://localhost:3000/api/dangki', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ taikhoan, matkhau, trangthaidangnhap })
                });
                if (response.ok) {
                    alert('đăng kí thành công');
                    let taikhoandangnhap = [
                        {
                            tentaikhoan: taikhoan,
                            matkhaudn: matkhau,
                        }
                    ];
                    localStorage.setItem('dangnhap', JSON.stringify(taikhoandangnhap));
                    document.getElementById('nhaptaikhoan').value = '';
                    document.getElementById('nhapmatkhau').value = '';
                    document.getElementById('nhaplaimatkhau').value = '';
                    window.location.href = 'index_dangnhap.html';
                } else {
                    alert('Tài khoản đã tồn tại');
                }
            } catch (err) {
                console.error('Lỗi:', err);
            }
        }

        // Hàm đăng nhập
        async function dangnhap() {
            const taikhoan = document.getElementById("nhaptaikhoan1").value.trim();
            const matkhau = document.getElementById("nhapmatkhau1").value.trim();
            if (!taikhoan || !matkhau) {
                alert("Vui lòng nhập thông tin đăng nhập");
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/dangnhap', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ taikhoan, matkhau })
                });
                if (response.status === 201) {
                    alert("đăng nhập thành công");
                    let taikhoandangnhap = [
                        {
                            tentaikhoan: taikhoan,
                            matkhaudn: matkhau,
                        }
                    ];
                    localStorage.setItem('dangnhap', JSON.stringify(taikhoandangnhap));
                    document.getElementById("nhaptaikhoan1").value = "";
                    document.getElementById("nhapmatkhau1").value = "";
                    window.location.href = 'index_dangnhap.html';
                } else if (response.status === 200) {
                    alert("đăng nhập quyền admin");
                    let taikhoandangnhap = [
                        {
                            tentaikhoan: taikhoan,
                            matkhaudn: matkhau,
                        }
                    ];
                    localStorage.setItem('dangnhap', JSON.stringify(taikhoandangnhap));
                    document.getElementById("nhaptaikhoan1").value = "";
                    document.getElementById("nhapmatkhau1").value = "";
                    window.location.href = 'index_Admin.html';
                }
                else {
                    alert("tài khoản không tồn tại");
                    return;
                }
            } catch (err) {
                console.error('Lỗi:', err);
            }
        }

        // Tìm kiếm theo thể loại
        document.getElementById("listtheloai").addEventListener("click", function (e) {
            const data = e.target.closest('.dropdown-item');
            timkiemtheloai(data.textContent);
        })

        async function timkiemtheloai(theloaitimkiem) {
            const data = theloaitimkiem;
            if (!data) {
                alert("Vui long nhap thong tin tim kiem");
                return;
            }

            try {
                const response = await fetch(`http://localhost:3000/api/timkiemtheloai?query=${encodeURIComponent(data)}`, {
                    method: 'GET'
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                    return;
                }
                const ketqua = await response.json();
                const ketquatimkiemData = ketqua.ketquatimkiem || [];
                if (ketquatimkiemData.length > 0) {
                    localStorage.setItem('ketquatimkiem', JSON.stringify(ketquatimkiemData));
                    localStorage.setItem('isSearch', 'true');
                    const iframe = document.getElementById("Chitietsach");
                    iframe.src = ketqua.redirect;
                } else {
                    alert("Không tìm thấy kết quả nào");
                    return;
                }
            } catch (err) {
                console.error('Lỗi:', err);
            }
        }

        window.addEventListener("DOMContentLoaded", async function () {
            try {
                const response = await fetch('http://localhost:3000/api/dangxuathangloat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },

                });
                if (response.ok) {
                    localStorage.removeItem('dangnhap');
                    localStorage.removeItem('ketquatimkiemyeuthich');
                    localStorage.removeItem('listsachyeuthich');
                    localStorage.removeItem('book'); // update
                    localStorage.removeItem('danhgia'); // update
                    // localStorage.removeItem('isSearch');
                } else {
                    alert("đăng xuất thất bại");
                    return;
                }
            } catch (err) {
                console.error('Lỗi:', err);
            }

        })


        window.addEventListener("DOMContentLoaded", function () {
            const iframe = document.getElementById("Chitietsach");
            iframe.onload = function () {
                // Đặt chiều cao ban đầu với khoảng đệm
                iframe.style.height = "1000px"; // Giá trị tạm thời
            };

            window.addEventListener("message", function (event) {
                if (event.data.height) {
                    const iframe = document.getElementById("Chitietsach");
                    const buffer = 20; // Khoảng cách đệm (tương ứng với margin-bottom)
                    iframe.style.height = Math.max(event.data.height - buffer, 1000) + "px"; // Giảm chiều cao để tránh footer
                }
            });
        });
        (function () { if (!window.chatbase || window.chatbase("getState") !== "initialized") { window.chatbase = (...arguments) => { if (!window.chatbase.q) { window.chatbase.q = [] } window.chatbase.q.push(arguments) }; window.chatbase = new Proxy(window.chatbase, { get(target, prop) { if (prop === "q") { return target.q } return (...args) => target(prop, ...args) } }) } const onLoad = function () { const script = document.createElement("script"); script.src = "https://www.chatbase.co/embed.min.js"; script.id = "pZmBRIKTwTgRS_esCfk_p"; script.domain = "www.chatbase.co"; document.body.appendChild(script) }; if (document.readyState === "complete") { onLoad() } else { window.addEventListener("load", onLoad) } })();
    </script>

    <script src="bootstrap-5.3.5-dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>