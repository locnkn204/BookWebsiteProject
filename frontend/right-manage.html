<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Right manage</title>
    <!-- Link Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Link Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        
        body {
            background: #1b1e21;
        }

        .btn {
            width: 6.5em;
            height: 2.3em;
            margin: 0.5em;
            background: black;
            color: white;
            border: none;
            border-radius: 0.625em;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .btn:hover {
            color: black;
            font-weight: bold;
        }

        .btn-add {
            background: #0d6efd;
        }

        .btn-delete {
            background: #dc3545;
        }

        .btn-edit {
            color: black;
            background: #ffc107;
        }

        button:after {
            content: "";
            background: white;
            position: absolute;
            z-index: -1;
            left: -20%;
            right: -20%;
            top: 0;
            bottom: 0;
            transform: skewX(-45deg) scale(0, 1);
            transition: all 0.5s;
        }

        button:hover:after {
            transform: skewX(-45deg) scale(1, 1);
            -webkit-transition: all 0.5s;
            transition: all 0.5s;
        }
    </style>
</head>

<body>
    <div class="container-fluid text-white ">
        <div style="max-width: 1400px; width: 100%;">
            <div class="row mt-2 mb-1">
                <div class="col-6">
                    <h3 class="mt-3 ms-3">DANH SÁCH TÀI KHOẢN</h3>
                </div>
                <div class="col-6 d-flex justify-content-end">
                    <button class="btn btn-delete" id="xoataikhoan">DELETE</button>
                    <div id="inputContainer"></div>
                    <button class="btn btn-edit" id="suamatkhau">EDIT</button>
                    <div id="inputContainer1"></div>
                </div>
                 <hr class="mt-1">
            </div>
           
            <table class="table table-bordered table-hover table-striped  table-hover table-dark text-center">
                <thead class="table-light text-center">
                    <tr>
                        <th>STT</th>
                        <th>Tên Đăng Nhập</th>
                        <th>PassWord</th>
                        <th>Trạng thái</th>
                    </tr>
                </thead>
                <tbody id="listtaikhoan">
                   
                </tbody>
            </table>

        </div>
        <script>
            // hàm load dnah sách tài khoản
            async function laydanhsachtaikhoan() {
            try {
                const response = await fetch('http://localhost:3000/api/listtaikhoan',{
                method: 'GET'
            });
            let cnt =0, trangthai;
            const theloais = await response.json();
            const listtheloai = document.getElementById('listtaikhoan');
            listtheloai.innerHTML = ''; 
            theloais.forEach(theloai => {
            cnt++;
            const tr = document.createElement('tr');
            if(theloai.TRANGTHAIDANGNHAP == 0)
            {
                trangthai = 'Đăng xuất';
            }else{
                trangthai = 'Đăng nhập';
            }
            tr.innerHTML = '<td>'+ cnt + '</td><td>'+ theloai.TENTAIKHOAN + '</td> '+ theloai.MATKHAU + '</td> <td>'+ trangthai + '</td>';
            listtheloai.appendChild(tr);
            });
            } catch (err) {
                console.error('Lỗi:', err);
            }
        }   
            
            // hàm ấn sẽ xuất hiện
            const deleteButton = document.getElementById('xoataikhoan');
            const inputContainer = document.getElementById('inputContainer');

            deleteButton.addEventListener('click', () => {
            if (inputContainer.innerHTML) return;

            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'taikhoanInput';
            input.placeholder = 'Nhập tài khoản muốn xóa';
            input.className = 'form-control me-2'; 

            const confirmButton = document.createElement('button');
            confirmButton.className = 'btn btn-primary me-2'; 
            confirmButton.textContent = 'OK';
            confirmButton.onclick = xoa;

            const cancelButton = document.createElement('button');
            cancelButton.className = 'btn btn-secondary';
            cancelButton.textContent = 'Hủy';
            cancelButton.onclick = () => {
            inputContainer.innerHTML = '';
            deleteButton.disabled = false;
        };

            inputContainer.className = 'input-container d-flex align-items-center';
            inputContainer.appendChild(input);
            inputContainer.appendChild(confirmButton);
            inputContainer.appendChild(cancelButton);

            deleteButton.disabled = true;
        });

        // xóa tài khoản
            async function xoa() {
            const taikhoan = document.getElementById('taikhoanInput').value;
            if (!taikhoan) {
                alert('Vui lòng nhập tài khoản!');
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/listtaikhoan', {
                    method: 'DELETE',
                    headers: {'Content-Type': 'application/json',},
                    body: JSON.stringify({ tentaikhoan: taikhoan }),
                });

                const data = await response.json();
                alert(data.message || 'Xóa tài khoản thành công!');

                if (response.ok) {
                    inputContainer.innerHTML = '';
                    deleteButton.disabled = false;
                }
            } catch (error) {
                console.error('Lỗi:', error);
                alert('Lỗi khi xóa tài khoản: ' + error.message);
            }
        }
        
        // đổi mật khẩu
        const editButton = document.getElementById('suamatkhau');
        const inputContainer1 = document.getElementById('inputContainer1');


        editButton.addEventListener('click', () => {
            if (inputContainer.innerHTML) return;

            const usernameInput = document.createElement('input');
            usernameInput.type = 'text';
            usernameInput.id = 'tentaikhoanInput';
            usernameInput.placeholder = 'Nhập tên tài khoản';
            usernameInput.className = 'form-control me-2';

            const passwordInput = document.createElement('input');
            passwordInput.type = 'password';
            passwordInput.id = 'matkhauInput';
            passwordInput.placeholder = 'Nhập mật khẩu mới';
            passwordInput.className = 'form-control me-2';

            const confirmButton = document.createElement('button');
            confirmButton.className = 'btn btn-primary btn-confirm me-2';
            confirmButton.textContent = 'OK';
            confirmButton.onclick = doimatkhau;

            const cancelButton = document.createElement('button');
            cancelButton.className = 'btn btn-secondary';
            cancelButton.textContent = 'Hủy';
            cancelButton.onclick = () => {
            inputContainer.innerHTML = '';
            editButton.disabled = false;
            };

            inputContainer.className = 'input-container d-flex align-items-center';
            inputContainer.appendChild(usernameInput);
            inputContainer.appendChild(passwordInput);
            inputContainer.appendChild(confirmButton);
            inputContainer.appendChild(cancelButton);

            editButton.disabled = true;
        });

        async function doimatkhau() {
            const tentaikhoan = document.getElementById('tentaikhoanInput').value;
            const matkhau = document.getElementById('matkhauInput').value;
            if (!tentaikhoan || !matkhau ) {
                alert('Vui lòng nhập đầy đủ tên tài khoản và mật khẩu!');
                return;
            }else if(matkhau.length < 6){
                alert('Nhap đủ kí tự, tối thiể 6 kí tự');
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/doimatkhau', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json',},
                    body: JSON.stringify({ tentaikhoan, matkhau }),
                });

            const data = await response.json();
            alert(data.message || 'Đổi mật khẩu thành công!');

            if (response.ok) {
                inputContainer.innerHTML = '';
                editButton.disabled = false;
            }
            } catch (error) {
                console.error('Lỗi:', error);
                alert('Lỗi khi đổi mật khẩu: ' + (error.message || 'Không thể kết nối đến server'));
            }
        }
        
        
        window.addEventListener("DOMContentLoaded",function(){
            laydanhsachtaikhoan();
        })
        </script>
</body>

</html>